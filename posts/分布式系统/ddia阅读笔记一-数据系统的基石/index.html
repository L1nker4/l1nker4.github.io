<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.145.0">

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="" />
  <meta property="og:url" content="http://localhost:1313/posts/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/ddia%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9F%BA%E7%9F%B3/" />
  <link rel="canonical" href="http://localhost:1313/posts/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/ddia%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9F%BA%E7%9F%B3/" /><link rel="apple-touch-icon" href="/favicon.png" />
  <link rel="icon" href="/favicon.png" />
  <link rel="shortcut" href="/favicon.png" /><link rel="alternate" type="application/atom+xml" href="http://localhost:1313/index.xml" title="L1nker4&#39;s Blog | 格木观云">

  <script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "http:\/\/localhost:1313\/"
      },
      "articleSection" : "posts",
      "name" : "DDIA阅读笔记(一)-数据系统的基石",
      "headline" : "DDIA阅读笔记(一)-数据系统的基石",
      "description" : "第一章：可靠性、可伸缩性、可维护性 应用的两个分类：\ndata-intensive：问题通常来自数据量、数据复杂性、以及数据的变更速度。 compute-intensive：瓶颈在于CPU。 可靠性 可以把可靠性粗略理解为 “即使出现问题，也能继续正确工作”。\n造成错误的原因叫做 故障（fault），能预料并应对故障的系统特性可称为 容错（fault-tolerant） 或 韧性（resilient）。\nfault种类：\n硬件故障（hardware faults） 增加单个硬件的冗余度：磁盘可以组建RAID、服务器使用双路电源和热拔插CPU等。 云平台的设计就是优先考虑 **灵活性（flexibility）**和 弹性（elasticity），而不是单机可靠性。 引入软件容错机制。 系统性错误（systematic error） 软件错误 修复问题代码、进程隔离、监控分析 人为错误 以最小化犯错机会的方式设计系统：精心设计的API 与最容易犯错的模块解耦 彻底的测试：单元测试、系统测试 允许从人为错误中简单快速地恢复：快速回滚配置变更、分批发布新代码。 配置详细地监控，比如性能指标和错误率。 可伸缩性 可伸缩性（Scalability） 是用来描述系统应对负载增长能力的术语。\n描述性能的指标：\n吞吐量（throughput）：每秒可以处理的记录数量。或者在特定规模数据集上运行作业的总时间。 响应时间（response time）：客户端发送请求到接收响应之间的时间。 响应时间的高百分位点（尾部延迟）指标非常重要 处理方法：\n垂直伸缩：转向更强大的机器。 水平伸缩：负载分布到多台小机器。 弹性（elastic）：在检测到负载增加时自动增加计算资源\n可维护性 三个设计原则来避免自己的软件系统变为遗留系统：\n可操作性 简单性 可演化性 可操作性 监控系统提供可见性 将系统与标准化工具集成 避免单机部署 提供良好的文档 提供良好的默认行为（配置参数？） 自我修复 行为可预测 简单性 消除额外复杂度的最好工具之一是抽象。\n抽象帮助我们控制系统复杂度。\n可演化性 系统的需求是变化的，使用敏捷工作模式来应对，例如TDD和重构。\n第二章：数据模型与查询语言 问题：需要将数据模型抽象成对应的概念。\n每个层都通过提供一个明确的数据模型来隐藏更低层次中的复杂性。\n关系模型和文档模型 关系模型 常见分类：\nTP（事务性）：银行交易 AP（分析型）：数据报表 HTAP（混合型） 问题：关系模型很难直观表达一对多的关系．\n",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "2022",
      "datePublished": "2022-04-03 18:59:06 \u002b0000 UTC",
      "dateModified" : "2022-04-03 18:59:06 \u002b0000 UTC",
      "url" : "http:\/\/localhost:1313\/posts\/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F\/ddia%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9F%BA%E7%9F%B3\/",
      "keywords" : [ "分布式系统", ]
  }
</script>
<title>DDIA阅读笔记(一)-数据系统的基石</title>
  <meta property="og:title" content="DDIA阅读笔记(一)-数据系统的基石" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="第一章：可靠性、可伸缩性、可维护性 应用的两个分类：
data-intensive：问题通常来自数据量、数据复杂性、以及数据的变更速度。 compute-intensive：瓶颈在于CPU。 可靠性 可以把可靠性粗略理解为 “即使出现问题，也能继续正确工作”。
造成错误的原因叫做 故障（fault），能预料并应对故障的系统特性可称为 容错（fault-tolerant） 或 韧性（resilient）。
fault种类：
硬件故障（hardware faults） 增加单个硬件的冗余度：磁盘可以组建RAID、服务器使用双路电源和热拔插CPU等。 云平台的设计就是优先考虑 **灵活性（flexibility）**和 弹性（elasticity），而不是单机可靠性。 引入软件容错机制。 系统性错误（systematic error） 软件错误 修复问题代码、进程隔离、监控分析 人为错误 以最小化犯错机会的方式设计系统：精心设计的API 与最容易犯错的模块解耦 彻底的测试：单元测试、系统测试 允许从人为错误中简单快速地恢复：快速回滚配置变更、分批发布新代码。 配置详细地监控，比如性能指标和错误率。 可伸缩性 可伸缩性（Scalability） 是用来描述系统应对负载增长能力的术语。
描述性能的指标：
吞吐量（throughput）：每秒可以处理的记录数量。或者在特定规模数据集上运行作业的总时间。 响应时间（response time）：客户端发送请求到接收响应之间的时间。 响应时间的高百分位点（尾部延迟）指标非常重要 处理方法：
垂直伸缩：转向更强大的机器。 水平伸缩：负载分布到多台小机器。 弹性（elastic）：在检测到负载增加时自动增加计算资源
可维护性 三个设计原则来避免自己的软件系统变为遗留系统：
可操作性 简单性 可演化性 可操作性 监控系统提供可见性 将系统与标准化工具集成 避免单机部署 提供良好的文档 提供良好的默认行为（配置参数？） 自我修复 行为可预测 简单性 消除额外复杂度的最好工具之一是抽象。
抽象帮助我们控制系统复杂度。
可演化性 系统的需求是变化的，使用敏捷工作模式来应对，例如TDD和重构。
第二章：数据模型与查询语言 问题：需要将数据模型抽象成对应的概念。
每个层都通过提供一个明确的数据模型来隐藏更低层次中的复杂性。
关系模型和文档模型 关系模型 常见分类：
TP（事务性）：银行交易 AP（分析型）：数据报表 HTAP（混合型） 问题：关系模型很难直观表达一对多的关系．
" />
  <meta name="description" content="第一章：可靠性、可伸缩性、可维护性 应用的两个分类：
data-intensive：问题通常来自数据量、数据复杂性、以及数据的变更速度。 compute-intensive：瓶颈在于CPU。 可靠性 可以把可靠性粗略理解为 “即使出现问题，也能继续正确工作”。
造成错误的原因叫做 故障（fault），能预料并应对故障的系统特性可称为 容错（fault-tolerant） 或 韧性（resilient）。
fault种类：
硬件故障（hardware faults） 增加单个硬件的冗余度：磁盘可以组建RAID、服务器使用双路电源和热拔插CPU等。 云平台的设计就是优先考虑 **灵活性（flexibility）**和 弹性（elasticity），而不是单机可靠性。 引入软件容错机制。 系统性错误（systematic error） 软件错误 修复问题代码、进程隔离、监控分析 人为错误 以最小化犯错机会的方式设计系统：精心设计的API 与最容易犯错的模块解耦 彻底的测试：单元测试、系统测试 允许从人为错误中简单快速地恢复：快速回滚配置变更、分批发布新代码。 配置详细地监控，比如性能指标和错误率。 可伸缩性 可伸缩性（Scalability） 是用来描述系统应对负载增长能力的术语。
描述性能的指标：
吞吐量（throughput）：每秒可以处理的记录数量。或者在特定规模数据集上运行作业的总时间。 响应时间（response time）：客户端发送请求到接收响应之间的时间。 响应时间的高百分位点（尾部延迟）指标非常重要 处理方法：
垂直伸缩：转向更强大的机器。 水平伸缩：负载分布到多台小机器。 弹性（elastic）：在检测到负载增加时自动增加计算资源
可维护性 三个设计原则来避免自己的软件系统变为遗留系统：
可操作性 简单性 可演化性 可操作性 监控系统提供可见性 将系统与标准化工具集成 避免单机部署 提供良好的文档 提供良好的默认行为（配置参数？） 自我修复 行为可预测 简单性 消除额外复杂度的最好工具之一是抽象。
抽象帮助我们控制系统复杂度。
可演化性 系统的需求是变化的，使用敏捷工作模式来应对，例如TDD和重构。
第二章：数据模型与查询语言 问题：需要将数据模型抽象成对应的概念。
每个层都通过提供一个明确的数据模型来隐藏更低层次中的复杂性。
关系模型和文档模型 关系模型 常见分类：
TP（事务性）：银行交易 AP（分析型）：数据报表 HTAP（混合型） 问题：关系模型很难直观表达一对多的关系．
" />
  <meta property="og:locale" content="en-us" /><meta property="og:image" content="/favicon.png" />
  

  
    <style>body{font-family:bree serif,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px}article{max-width:1000px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none}a:hover{font-weight:600;text-decoration:underline}.post-ads{margin:50px 0}.markdown-body{font-size:18px}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body blockquote{margin:0;padding:0 1em;color:#57606a;border-left:.25em solid #d0d7de}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px}.markdown-body code{padding:.2em .4em;font-size:75%;background-color:#f6f8fa;border-radius:6px}.markdown-body pre>code{padding:0;font-size:75%;background-color:inherit;border:0;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:1.6}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.header-title{font-size:2rem;font-weight:700;margin-top:32px}.header-title a{text-decoration:none}.header-subtitle{color:#666}.header-items{margin:10px 0}.header-item{margin:0 5px}.header-line{width:100%;border-width:2px;border-color:#482936;border-style:solid none none none}.lang-switch{font-weight:600}#posts-list{min-height:600px}.posts-line{font-size:1.2rem;margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{padding:3px 0;border:#000 2px solid;border-radius:5px}.site-footer{margin-top:50px}.site-footer-item{margin-right:12px}.post-header{margin-bottom:50px}.post-title{font-size:2rem;font-weight:600}.post-tags{display:inline;font-weight:600;padding:2px 5px;margin-right:6px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:800;font-style:italic}.post-author{float:right;font-weight:600}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.post-content img{max-width:100%;display:block;margin-right:auto;margin-top:6px}.post-content .post-gallery{display:flex;flex-wrap:wrap;gap:6px}.post-content .post-gallery img{margin-right:auto;margin-top:auto;width:calc(50% - 3px)}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}@media screen and (max-width:600px){.header-title,.header-subtitle,.header-items{}.posts-line{font-size:16px}.markdown-body{font-size:16px}.post-title{font-size:2rem}.post-content p{letter-spacing:.05em}.post-content .post-gallery img{width:100%}}@media screen and (max-width:48em){.posts-category{display:none}}table,th,td{border-collapse:collapse;border-style:solid}</style>
  
  
    <style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style>
  

  

  <link href="/index.xml" rel="alternate" type="application/rss+xml"
    title="L1nker4&#39;s Blog | 格木观云">
  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade" rel="stylesheet">
  
  

  
  
</head>


<body>
  <article class="post " id="article">
    <div class="row">
      <div class="col-xs-12">
        <div class="site-header">
          
<header>
  <div class="header-title">
    <a href="/"
      >L1nker4&#39;s Blog</a
    >
  </div>
  <div class="header-subtitle">提升认知，解构世界，行有不得，反求诸己</div>
</header>
<div class="row end-md header-items">
  
  <div class="header-item">
    <a href="/links" target="_blank">Links</a>
  </div>
  
  <div class="header-item">
    <a href="/about" target="_blank">About</a>
  </div>
  
  <div class="header-item">
    <a href="/index.xml" target="_blank">RSS</a>
  </div>
  
</div>
<div class="row">
   
</div>
<div class="header-line"></div>

        </div>
        <header class="post-header">
          <h1 class="post-title">DDIA阅读笔记(一)-数据系统的基石</h1>
          
          <div class="row post-desc">
            <div class="col-xs-6">
              
              <time class="post-date" datetime="2022-04-03 18:59:06 UTC">
                
                  2022-04-03
                
              </time>
              
            </div>
            <div class="col-xs-6">
              
            </div>
          </div>
          
        </header>

        <div class="row">
          <div class="col-xs-12 col-md-9">
            <div class="post-content markdown-body">
              
              <h2 id="第一章可靠性可伸缩性可维护性">第一章：可靠性、可伸缩性、可维护性</h2>
<p>应用的两个分类：</p>
<ul>
<li><strong>data-intensive</strong>：问题通常来自数据量、数据复杂性、以及数据的变更速度。</li>
<li><strong>compute-intensive</strong>：瓶颈在于CPU。</li>
</ul>
<h3 id="可靠性">可靠性</h3>
<p>可以把可靠性粗略理解为 “即使出现问题，也能继续正确工作”。</p>
<p>造成错误的原因叫做 <strong>故障（fault）</strong>，能预料并应对故障的系统特性可称为 <strong>容错（fault-tolerant）</strong> 或 <strong>韧性（resilient）</strong>。</p>
<p>fault种类：</p>
<ul>
<li><strong>硬件故障（hardware faults）</strong>
<ul>
<li>增加单个硬件的冗余度：磁盘可以组建RAID、服务器使用双路电源和热拔插CPU等。</li>
<li>云平台的设计就是优先考虑 **灵活性（flexibility）**和 <strong>弹性（elasticity）</strong>，而不是单机可靠性。</li>
<li>引入软件容错机制。</li>
</ul>
</li>
<li><strong>系统性错误（systematic error）</strong>
<ul>
<li>软件错误</li>
<li>修复问题代码、进程隔离、监控分析</li>
</ul>
</li>
<li><strong>人为错误</strong>
<ul>
<li>以最小化犯错机会的方式设计系统：精心设计的API</li>
<li>与最容易犯错的模块解耦</li>
<li>彻底的测试：单元测试、系统测试</li>
<li>允许从人为错误中简单快速地恢复：快速回滚配置变更、分批发布新代码。</li>
<li>配置详细地监控，比如性能指标和错误率。</li>
</ul>
</li>
</ul>
<h3 id="可伸缩性">可伸缩性</h3>
<p><strong>可伸缩性（Scalability）</strong> 是用来描述系统应对负载增长能力的术语。</p>
<p>描述性能的指标：</p>
<ul>
<li><strong>吞吐量（throughput）</strong>：每秒可以处理的记录数量。或者在特定规模数据集上运行作业的总时间。</li>
<li><strong>响应时间（response time）</strong>：客户端发送请求到接收响应之间的时间。
<ul>
<li>响应时间的高百分位点（尾部延迟）指标非常重要</li>
</ul>
</li>
</ul>
<p>处理方法：</p>
<ul>
<li>垂直伸缩：转向更强大的机器。</li>
<li>水平伸缩：负载分布到多台小机器。</li>
</ul>
<p><strong>弹性（elastic）</strong>：在检测到负载增加时自动增加计算资源</p>
<h3 id="可维护性">可维护性</h3>
<p>三个设计原则来避免自己的软件系统变为遗留系统：</p>
<ul>
<li>可操作性</li>
<li>简单性</li>
<li>可演化性</li>
</ul>
<h4 id="可操作性">可操作性</h4>
<ul>
<li>监控系统提供可见性</li>
<li>将系统与标准化工具集成</li>
<li>避免单机部署</li>
<li>提供良好的文档</li>
<li>提供良好的默认行为（配置参数？）</li>
<li>自我修复</li>
<li>行为可预测</li>
</ul>
<h4 id="简单性">简单性</h4>
<p>消除<strong>额外复杂度</strong>的最好工具之一是<strong>抽象</strong>。</p>
<p>抽象帮助我们控制系统复杂度。</p>
<h4 id="可演化性">可演化性</h4>
<p>系统的需求是变化的，使用敏捷工作模式来应对，例如TDD和重构。</p>
<h2 id="第二章数据模型与查询语言">第二章：数据模型与查询语言</h2>
<p>问题：需要将数据模型抽象成对应的概念。</p>
<p>每个层都通过提供一个明确的数据模型来隐藏更低层次中的复杂性。</p>
<h3 id="关系模型和文档模型">关系模型和文档模型</h3>
<h4 id="关系模型">关系模型</h4>
<p>常见分类：</p>
<ul>
<li>TP（事务性）：银行交易</li>
<li>AP（分析型）：数据报表</li>
<li>HTAP（混合型）</li>
</ul>
<p>问题：关系模型很难直观表达<strong>一对多的关系</strong>．</p>
<p>文档模型的优势：</p>
<ul>
<li>模式灵活：动态增删字段</li>
<li>更好的局部性：一个人的所有属性被集中访问</li>
<li>结构表达语义：JSON的树状结构能够表达语义</li>
</ul>
<h4 id="层次模型">层次模型</h4>
<p>几个要点：</p>
<ul>
<li>树状结构，每个节点只允许一个父节点</li>
<li>节点存储数据，节点分类型</li>
<li>节点间使用指针连接</li>
</ul>
<h4 id="网状模型">网状模型</h4>
<p>多对一和多对多都由路径来表示，访问记录的唯一方式是顺着元素路径访问。</p>
<h4 id="文档模型">文档模型</h4>
<p>文档型数据库的使用场景：</p>
<ul>
<li>多种类型数据，放一张表不合适</li>
<li>数据类型和结构由外部决定，没办法控制数据的变化</li>
</ul>
<p>MySQL和PgSQL支持JSON。</p>
<h3 id="数据查询语言">数据查询语言</h3>
<p>分为声明式语言（SQL）和命令式语言（通用编程语言）。</p>
<p>命令式语言的优点：</p>
<ul>
<li>描述目标复杂时，声明式表达能力不够。</li>
<li>可以通过抽象、编程范式等，让代码兼顾表达力和清晰性。</li>
</ul>
<h4 id="mapreduce">MapReduce</h4>
<p>MapReduce模型：</p>
<ul>
<li>借鉴自函数式编程</li>
<li>简单的编程模型</li>
</ul>
<p>特点：</p>
<ul>
<li>要求Map和Reduce是纯函数</li>
<li>非常底层，但是表达力强大，可基于其实现高级查询语言，例如Hive。</li>
</ul>
<p>注意点：</p>
<ul>
<li>不是所有的分布式SQL都基于MapReduce</li>
<li>不是只有MapReduce才能嵌入通用语言</li>
<li>MapReduce有一定的理解成本</li>
</ul>
<h3 id="图模型">图模型</h3>
<p>典型案例：</p>
<ul>
<li>社交图谱</li>
<li>网络图谱</li>
<li>公路或铁路网络</li>
</ul>
<p>应用场景：</p>
<ul>
<li>文档数据库：数据都是自我包含的，文档之间的关系非常稀少</li>
<li>图数据库：任意事物都能其他事务相关联</li>
</ul>
<h2 id="第三章存储与检索">第三章：存储与检索</h2>
<h3 id="存储使用的数据结构">存储使用的数据结构</h3>
<p>世界上最简单的数据库案例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>db_set <span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">,</span>$2<span style="color:#e6db74">&#34;</span> &gt;&gt; database
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>db_get <span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  grep <span style="color:#e6db74">&#34;^</span>$1<span style="color:#e6db74">,&#34;</span> database | sed -e <span style="color:#e6db74">&#34;s/^</span>$1<span style="color:#e6db74">,//&#34;</span> | tail -n <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>两个bash函数实现了键值存储的功能，该模式下更新旧版本时不会覆盖，而是向文件末尾追加记录，查找最新值时，找到文件中key出现的最后一次位置。</p>
<p>当数据量激增，需要使用<code>索引</code>对查询进行优化。</p>
<p>大致思想：通过保存一些额外的元数据作为index帮我们找到想要的数据。</p>
<p>需要权衡的点：索引加快了读查询的速度，拖慢了写入的速度。</p>
<h4 id="散列索引">散列索引</h4>
<p>将每个键都进行一次哈希映射，并存储到相应的偏移量位置，当查询指定键时，使用哈希函数计算出相应的值，并读取指定偏移位置的数据。<code>Bitcask</code>存储模型使用的该种方式，该结构适合多次更新键对应的值的情况。</p>
<p>优化的点：每当日志增长到对应阈值时，开始写入一个新的日志文件，并对之前的日志进行compaction。（Bitcask的Merge策略是类似方案）</p>
<p>实现过程中要考虑的问题：</p>
<ul>
<li>文件格式：使用二进制最快，字节为单位进行编码</li>
<li>删除操作：删除操作向日志尾追加一个删除记录，当进行compaction时将被删除的数据都丢弃掉。</li>
<li>奔溃恢复：当数据库重新启动，需要从磁盘中的日志文件进行数据恢复。</li>
<li>部分写入记录：考虑写入校验和等信息</li>
<li>并发控制：保证线程安全</li>
</ul>
<p>Q：为什么删除操作设计成追加方式，而不是直接在日志中进行修改？</p>
<ul>
<li>追加操作是<strong>磁盘顺序写</strong>，比随机写入快</li>
<li>日志文件仅追加的话，并发和崩溃恢复更简单。’</li>
<li>merge操作可以避免文件碎片化。</li>
</ul>
<p>散列结构的局限性：</p>
<ul>
<li>所有key必须放内存，存在大量的随机IO</li>
<li>范围查询效率不高，需要逐个遍历</li>
</ul>
<h4 id="sstables和lsm-tree">SSTables和LSM Tree</h4>
<p>将上述的键值对按照键排序，这个结构被称为<code>Sorted String Table</code>，要求每个键只出现一次（merge保证），该结构有如下优势：</p>
<ol>
<li>文件大于可用内存，合并操作仍然有效。</li>
<li>可以通过类似二分查找的方式去查找（顺序列表特性）</li>
<li>可以将table分组为block，并将其写入磁盘。</li>
</ol>
<p><strong>如何构建和维护SSTables</strong>？</p>
<ul>
<li>构建：在内存中维护一个有序结构（MemTable），使用RB Tree、AVL Tree等
<ul>
<li>达到指定阈值后全量dump到外存</li>
<li>查询逻辑：
<ol>
<li>先去MemTable中查找，如果命中则返回。</li>
<li>否则再去SSTable按时间顺序由新到旧逐个查找。</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>存在的问题：出现宕机，内存中数据结构会丢失，使用<strong>WAL</strong>解决该问题</p>
<p>将上述内容继续优化，就会得到<code>LevelDB</code>和<code>RocksDB</code>所有的存储引擎<code>LSM-Tree(Log-Structured Merge-Tree)</code>，<code>ElasticSearch</code>使用的<code>Lucene </code>也是使用类似结构。</p>
<p>优化：</p>
<ul>
<li>
<p>优化SSTable的查找：使用<code>Bloom Filter</code>做数据初筛。</p>
</li>
<li>
<p>层次化组织SSTable：控制Compaction的顺序和时间，常用的有：<code>size-tiered</code> 和 <code>leveled compaction</code></p>
<ul>
<li>size-tiered：较新、较小的SSTables合并到较大、较旧的SSTables中。</li>
<li>leveled compaction：key被按照范围拆分到较小的SSTables，较旧的数据被移动到单独的level。</li>
</ul>
</li>
</ul>
<p>LSM-Tree的<strong>核心思想</strong>：保存一组合理组织、后台合并的SSTables。</p>
<h4 id="b-tree">B Tree</h4>
<p>B Tree目前用于几乎所有的关系型数据库中，支持高效的定值查询和范围查询。</p>
<p>B Tree的优化：</p>
<ul>
<li>不使用WAL，在写入时利用<code>Copy On Write </code>技术。</li>
<li>对中间节点的key做压缩，增大了分支。</li>
<li>为了优化范围查询，有的B Tree将叶子节点存储时物理连续，但是数据插入时，维护有序性的代价很大。</li>
<li>为叶子节点增加兄弟指针（B+Tree），避免顺序查找时的回溯。</li>
</ul>
<h4 id="b-tree-对比-lsm-tree">B Tree 对比 LSM Tree</h4>
<table>
  <thead>
      <tr>
          <th style="text-align: center">存储引擎</th>
          <th style="text-align: center">B-Tree</th>
          <th style="text-align: center">LSM-Tree</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">优势</td>
          <td style="text-align: center">读取快</td>
          <td style="text-align: center">写入快</td>
      </tr>
      <tr>
          <td style="text-align: center">写放大</td>
          <td style="text-align: center">数据和WAL；更改数据时多次覆盖整个Page</td>
          <td style="text-align: center">数据和WAL；Compaction</td>
      </tr>
      <tr>
          <td style="text-align: center">写吞吐</td>
          <td style="text-align: center">低，存在大量随机写</td>
          <td style="text-align: center">顺序写入，写吞吐较高</td>
      </tr>
      <tr>
          <td style="text-align: center">压缩率</td>
          <td style="text-align: center">存在较多内部碎片</td>
          <td style="text-align: center">更紧凑，没有内部碎片</td>
      </tr>
      <tr>
          <td style="text-align: center">存储放大</td>
          <td style="text-align: center">有些Page没有用满</td>
          <td style="text-align: center">同一个key存储多遍</td>
      </tr>
      <tr>
          <td style="text-align: center">并发控制</td>
          <td style="text-align: center">同一个key只存在一个地方；树结构容易被范围锁</td>
          <td style="text-align: center">同一个key存多变，使用MVCC控制</td>
      </tr>
  </tbody>
</table>
<h3 id="其他结构">其他结构</h3>
<p>聚集索引和非聚集索引：</p>
<ul>
<li>数据本身按照某个字段有序存储，基于该字段的索引被称为<strong>聚集索引</strong>。</li>
<li>索引中只存数据的引用的被称为非聚集索引。</li>
<li>一部分列嵌到索引中存储，剩余列额外存储，称为<strong>覆盖索引</strong>。</li>
</ul>
<h3 id="多列索引">多列索引</h3>
<p>多个字段联合查询的场景十分常见：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> restaurants <span style="color:#66d9ef">WHERE</span> latitude <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">51</span>.<span style="color:#ae81ff">4946</span> <span style="color:#66d9ef">AND</span> latitude <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">51</span>.<span style="color:#ae81ff">5079</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">AND</span> longitude <span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">1162</span> <span style="color:#66d9ef">AND</span> longitude <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">1004</span>;
</span></span></code></pre></div><p>方案：</p>
<ul>
<li>将latitude和longitude合并存储，转为一维</li>
<li>使用类似R Tree的地理空间索引存储</li>
<li>使用类似MySQL的联合索引解决</li>
</ul>
<h3 id="全文索引和模糊索引">全文索引和模糊索引</h3>
<p><code>Lucene</code> 中索引是字符的有限自动机，类似于<code>Trie</code>，支持在给定编辑距离内搜索单词。</p>
<h3 id="全内存数据结构">全内存数据结构</h3>
<p>内存数据库的优点：</p>
<ul>
<li>提供丰富的数据抽象</li>
<li>实现简单</li>
</ul>
<p>基于**非易失性存储器（non-volatile memory，NVM）**的存储引擎是最近的研究热点。</p>
<h2 id="事务性-or-分析性">事务性 or 分析性</h2>
<p>两者对比：</p>
<table>
  <thead>
      <tr>
          <th>属性</th>
          <th>事务处理系统 OLTP</th>
          <th>分析系统 OLAP</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>主要读取模式</td>
          <td>查询少量记录，按键读取</td>
          <td>在大批量记录上聚合</td>
      </tr>
      <tr>
          <td>主要写入模式</td>
          <td>随机访问，写入要求低延时</td>
          <td>批量导入（ETL）或者事件流</td>
      </tr>
      <tr>
          <td>主要用户</td>
          <td>终端用户，通过 Web 应用</td>
          <td>内部数据分析师，用于决策支持</td>
      </tr>
      <tr>
          <td>处理的数据</td>
          <td>数据的最新状态（当前时间点）</td>
          <td>随时间推移的历史事件</td>
      </tr>
      <tr>
          <td>数据集尺寸</td>
          <td>GB ~ TB</td>
          <td>TB ~ PB</td>
      </tr>
  </tbody>
</table>
<p>一开始OLAP仍然使用传统数据库，但是传统数据库在AP负载表现较差，因此转向专门做AP查询的<strong>数据仓库</strong>。</p>
<h3 id="数据仓库">数据仓库</h3>
<p>数仓是一个独立的数据库，从OLTP数据库提取数据，转换成适合分析的结构，清理并加载到数仓中，这个过程称为：<strong>抽取-转换-加载</strong>（ETL）。</p>
<h4 id="分歧">分歧</h4>
<p>数仓的数据模型通常是关系型的，但是查询引擎和存储格式优化方面，与OLTP数据库差别十分大。</p>
<h3 id="星状型-雪花型">星状型 雪花型</h3>
<ul>
<li>星状型：包含一张事件表和多张维度表，数据表以事件流方式将数据组织起来，然后用外键指向不同的维度。</li>
<li>雪花型：会在上述的维度表中进行二次细分。</li>
</ul>
<h2 id="列式存储">列式存储</h2>
<p>传统数据库按行存储，如果只查询一个字段，也必须从磁盘中取出剩余字段，浪费了IO带宽，增大了读放大。</p>
<p>如果将每一列的所有值存储在一起，查询效率大大增加。</p>
<h3 id="列压缩">列压缩</h3>
<p>当列中存在大量重复的数据，可以考虑对其进行压缩存储，数仓中特别有效的技术是位图编码。</p>
<h4 id="列族">列族</h4>
<p>这是HBase和Cassandra中的概念，从BigTable继承，每个列族中，将一行中所有列与行键一起存储，并且不使用列压缩。</p>
<p>因此BigTable在使用时主要面向行，可以理解为每个列族是一张子表。</p>
<h4 id="内存带宽和向量化处理">内存带宽和向量化处理</h4>
<p>数仓的超大规模数据量带来的瓶颈：</p>
<ul>
<li>内存处理带宽</li>
<li>CPU分支预测错误</li>
</ul>
<p>解决：</p>
<ul>
<li>列式存储和压缩可以让数据缓存在L1中，结合位图快速处理</li>
<li>使用SIMD、在更少的时钟周期处理更多的数据。</li>
</ul>
<h3 id="排序">排序</h3>
<p>可以像LSM-Tree那样，对所有行按某一列排序后存储。</p>
<h4 id="不同副本不同排序">不同副本，不同排序</h4>
<p>对数据的不同部分按照不同列进行有序存储，这样可以提供给不同查询需求，已有商用数仓Vertica 采用。</p>
<h3 id="列式存储的写入">列式存储的写入</h3>
<p>类似于LSM-Tree的追加操作：</p>
<ul>
<li>新写入的数据在内存中Batch好，按行按列，具体结构看需求</li>
<li>达到指定阈值，批量刷到外存，并于老数据合并。</li>
</ul>
<h3 id="聚合">聚合</h3>
<p>数仓查询通常涉及聚合函数，每次即时计算都会存在巨大浪费，可以考虑将其缓存下来。</p>
<p>与关系型数据库的View差别较大，视图是逻辑存在的，当物理存储发生改变，视图需要重新生成，写多读少的情况，维护代价很大。</p>
<p>数仓中的<strong>物化视图</strong>将其持久化存储，维护代价较低。</p>
<h2 id="第四章编码和演进">第四章：编码和演进</h2>
<h3 id="编码格式">编码格式</h3>
<p>涉及到跨进程通信，都需要对数据进行编码（序列化），因为通信都是面向字节流的，编码涉及两方面问题：</p>
<ul>
<li>如何编码能够节省空间、提高性能。</li>
<li>如何编码以适应数据的演化和兼容。</li>
</ul>
<p>当应用程序更新后，系统要顺利运行，要保证<strong>双向兼容性</strong>：</p>
<ul>
<li>向后兼容：新代码读取旧数据</li>
<li>向前兼容：旧代码读取新数据</li>
</ul>
<p>程序使用两种形式的数据：</p>
<ul>
<li>内存中的数据结构</li>
<li>网络通信时，编码成的字节序列</li>
</ul>
<h3 id="语言特定格式">语言特定格式</h3>
<p>编程语言内置了将内存对象编码为字节序列的组件：</p>
<ul>
<li>java.io.Serializable</li>
<li>Marshal</li>
<li>pickle</li>
<li>第三方库</li>
</ul>
<p>这类存在的问题：</p>
<ul>
<li>与编程语言深度绑定，其他语言很难读取这类数据</li>
<li>解码过程需要<strong>实例化任意类</strong>，存在安全问题：RCE</li>
<li>不存在数据版本控制</li>
<li>编解码效率低</li>
</ul>
<h3 id="jsonxml等">JSON、XML等</h3>
<p>存在的问题：</p>
<ul>
<li>数值的编码存在歧义：不能区分整数和浮点数</li>
<li>不支持二进制数据的字节序列</li>
<li>XML和JSON支持额外的模式，但是增加了复杂度</li>
</ul>
<h3 id="二进制编码">二进制编码</h3>
<p>如果数据只被单一程序读取，而不进行交换，不需要易读性等问题，可以使用二进制编码，其空间、速度方面都很可观。</p>
<h3 id="thrift与protocol-buffers">Thrift与Protocol Buffers</h3>
<p>上述两个是基于相同原理开发的二进制编码库</p>
<p>Protocol Buffers的接口定义语言（IDL）如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-protobuf" data-lang="protobuf"><span style="display:flex;"><span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">Person</span> {<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">required</span> <span style="color:#66d9ef">string</span> user_name       <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">optional</span> <span style="color:#66d9ef">int64</span>  favorite_number <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">repeated</span> <span style="color:#66d9ef">string</span> interests       <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>IDL与编程语言无关，可以利用代码生成工具，将上述IDL翻译为指定语言的代码。</p>
<p>Thrift还支持不同的编码格式：BinaryProtocol、CompactProtocol、JSON等</p>
<p>优势：</p>
<ul>
<li>省去字段名，更加紧凑</li>
<li>模式是数据的注释或文档，总是最新</li>
<li>数据模式允许不读取数据</li>
<li>对于静态类型来说 ，可以利用代码生成做编译时的类型检查</li>
</ul>
<h3 id="数据流模型">数据流模型</h3>
<ul>
<li>经过数据库的数据流</li>
<li>经过服务的数据流：REST和RPC
<ul>
<li>REST是一种设计哲学</li>
<li>RPC问题：
<ul>
<li>请求出现请求丢失、相应丢失等情况，需要重试</li>
<li>重试需要考虑<strong>幂等性</strong></li>
<li>两端编程语言不同可能会有影响</li>
</ul>
</li>
</ul>
</li>
<li>经过消息传递的数据流</li>
</ul>

            </div>
          </div>
          <div class="col-xs-12 col-md-3">
            <div class="post-toc">
              <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#第一章可靠性可伸缩性可维护性">第一章：可靠性、可伸缩性、可维护性</a>
          <ul>
            <li><a href="#可靠性">可靠性</a></li>
            <li><a href="#可伸缩性">可伸缩性</a></li>
            <li><a href="#可维护性">可维护性</a>
              <ul>
                <li><a href="#可操作性">可操作性</a></li>
                <li><a href="#简单性">简单性</a></li>
                <li><a href="#可演化性">可演化性</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#第二章数据模型与查询语言">第二章：数据模型与查询语言</a>
          <ul>
            <li><a href="#关系模型和文档模型">关系模型和文档模型</a>
              <ul>
                <li><a href="#关系模型">关系模型</a></li>
                <li><a href="#层次模型">层次模型</a></li>
                <li><a href="#网状模型">网状模型</a></li>
                <li><a href="#文档模型">文档模型</a></li>
              </ul>
            </li>
            <li><a href="#数据查询语言">数据查询语言</a>
              <ul>
                <li><a href="#mapreduce">MapReduce</a></li>
              </ul>
            </li>
            <li><a href="#图模型">图模型</a></li>
          </ul>
        </li>
        <li><a href="#第三章存储与检索">第三章：存储与检索</a>
          <ul>
            <li><a href="#存储使用的数据结构">存储使用的数据结构</a>
              <ul>
                <li><a href="#散列索引">散列索引</a></li>
                <li><a href="#sstables和lsm-tree">SSTables和LSM Tree</a></li>
                <li><a href="#b-tree">B Tree</a></li>
                <li><a href="#b-tree-对比-lsm-tree">B Tree 对比 LSM Tree</a></li>
              </ul>
            </li>
            <li><a href="#其他结构">其他结构</a></li>
            <li><a href="#多列索引">多列索引</a></li>
            <li><a href="#全文索引和模糊索引">全文索引和模糊索引</a></li>
            <li><a href="#全内存数据结构">全内存数据结构</a></li>
          </ul>
        </li>
        <li><a href="#事务性-or-分析性">事务性 or 分析性</a>
          <ul>
            <li><a href="#数据仓库">数据仓库</a>
              <ul>
                <li><a href="#分歧">分歧</a></li>
              </ul>
            </li>
            <li><a href="#星状型-雪花型">星状型 雪花型</a></li>
          </ul>
        </li>
        <li><a href="#列式存储">列式存储</a>
          <ul>
            <li><a href="#列压缩">列压缩</a>
              <ul>
                <li><a href="#列族">列族</a></li>
                <li><a href="#内存带宽和向量化处理">内存带宽和向量化处理</a></li>
              </ul>
            </li>
            <li><a href="#排序">排序</a>
              <ul>
                <li><a href="#不同副本不同排序">不同副本，不同排序</a></li>
              </ul>
            </li>
            <li><a href="#列式存储的写入">列式存储的写入</a></li>
            <li><a href="#聚合">聚合</a></li>
          </ul>
        </li>
        <li><a href="#第四章编码和演进">第四章：编码和演进</a>
          <ul>
            <li><a href="#编码格式">编码格式</a></li>
            <li><a href="#语言特定格式">语言特定格式</a></li>
            <li><a href="#jsonxml等">JSON、XML等</a></li>
            <li><a href="#二进制编码">二进制编码</a></li>
            <li><a href="#thrift与protocol-buffers">Thrift与Protocol Buffers</a></li>
            <li><a href="#数据流模型">数据流模型</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
            </div>
          </div>
        </div>

        <div class="row middle-xs">
          <div class="col-xs-12">
            
            <div class="post-tags">
              <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/">
                分布式系统
              </a>
            </div>
            
          </div>
        </div>
        
          <div class="row">
            <div class="col-xs-12">
              
            </div>
          </div>

          

<div class="related-content">
  <h3>Related Posts</h3>
  <ul>
    
    <li><a href="/posts/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA%E7%AC%94%E8%AE%B0/">分布式系统理论笔记</a></li>
    
    <li><a href="/posts/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/mapreduce-note/">MapReduce论文阅读笔记</a></li>
    
    <li><a href="/posts/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/">分布式锁的实现方案</a></li>
    
  </ul>
</div>



          
          
          <div style="height: 50px;"></div>
          
          <div class="post-comments">
            <div id="disqus_thread"></div>
<script>
  window.addEventListener("load", () => {
    (function() {
      
      var d = document,
        s = d.createElement("script");
      s.src = "https://evl1nker4.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  });
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>

          </div>
          
        

        <div class="site-footer">
  
  
</div>

      </div>
    </div>
  </article>

  

<script>
  
  
    
    
  
</script>

  

</body>

</html>