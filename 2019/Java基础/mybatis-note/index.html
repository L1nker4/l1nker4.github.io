

<!DOCTYPE html>
<html lang="zh-CN" >



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/favicon.ico">
  <link rel="icon" href="/favicon.ico">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Lin Wang">
  <meta name="keywords" content="l1nker4">
  
    <meta name="description" content="Mybatis简介开源免费框架，原名叫iBatis 作用：数据访问层框架，底层是对JDBC的封装 优点：  使用mybatis时不需要编写实现类，只需要写执行的sql命令  Mybatis简单使用mybatis-config.xml：全局配置文件 &lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt; &lt;!DOCTY">
<meta property="og:type" content="article">
<meta property="og:title" content="Mybatis学习笔记">
<meta property="og:url" content="https://l1n.wang/2019/Java%E5%9F%BA%E7%A1%80/mybatis-note/index.html">
<meta property="og:site_name" content="l1nker4&#39;s Blog">
<meta property="og:description" content="Mybatis简介开源免费框架，原名叫iBatis 作用：数据访问层框架，底层是对JDBC的封装 优点：  使用mybatis时不需要编写实现类，只需要写执行的sql命令  Mybatis简单使用mybatis-config.xml：全局配置文件 &lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt; &lt;!DOCTY">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="c:\Users\l1nke\AppData\Roaming\Typora\typora-user-images\1553326004994.png">
<meta property="article:published_time" content="2019-04-08T05:44:13.000Z">
<meta property="article:modified_time" content="2024-07-26T15:47:11.345Z">
<meta property="article:author" content="Lin Wang">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Mybatis">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="c:\Users\l1nke\AppData\Roaming\Typora\typora-user-images\1553326004994.png">
  
  
  
  <title>Mybatis学习笔记 - l1nker4&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  



  
<link rel="stylesheet" href="/css/custom.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"l1n.wang","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"612bbac3c11e86af5c472b8381f09fa7","google":null,"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null},"gtag":null,"woyaola":null,"cnzz":null},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?612bbac3c11e86af5c472b8381f09fa7";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>l1nker4&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://blog-1251613845.cos.ap-shanghai.myqcloud.com/bg/bg1.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Mybatis学习笔记"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2019-04-08 13:44" pubdate>
          2019年4月8日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          3.5k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          30 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Mybatis学习笔记</h1>
            
            
              <div class="markdown-body">
                
                <h3 id="Mybatis简介"><a href="#Mybatis简介" class="headerlink" title="Mybatis简介"></a>Mybatis简介</h3><p>开源免费框架，原名叫iBatis</p>
<p>作用：数据访问层框架，底层是对JDBC的封装</p>
<p>优点：</p>
<ul>
<li>使用mybatis时不需要编写实现类，只需要写执行的sql命令</li>
</ul>
<h3 id="Mybatis简单使用"><a href="#Mybatis简单使用" class="headerlink" title="Mybatis简单使用"></a>Mybatis简单使用</h3><p>mybatis-config.xml：全局配置文件</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span></span>
<span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span>
<span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;default&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;default&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3308/learnjsp?useSSL=false&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span>


    <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;UserMapper.xml&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre></div>





<p>mapper.xml文件：编写需要执行的SQL命令，把XML文件理解成实现类</p>
<p>UserMapper.xml：配置了sql语句，以及sql的封装规则</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span>
<span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span>
<span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>

<span class="hljs-comment">&lt;!--namespace:命名空间--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.test.UserMapper&quot;</span>&gt;</span>
    <span class="hljs-comment">&lt;!--</span>
<span class="hljs-comment">    id:sql语句的唯一标识</span>
<span class="hljs-comment">    parameterType:定义参数类型</span>
<span class="hljs-comment">    resultType:返回值类型</span>
<span class="hljs-comment">    如果方法返回值返回的是list,在resultType中写List的泛型</span>
<span class="hljs-comment">#&#123;id&#125;:外部传入的参数</span>
<span class="hljs-comment">    --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectUser&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.test.model.User&quot;</span>&gt;</span>
        select uid,uname,pwd,sex,age from t_user where id = #&#123;id&#125;
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div>





<p>测试</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.test.test;

<span class="hljs-keyword">import</span> com.test.model.User;
<span class="hljs-keyword">import</span> org.apache.ibatis.io.Resources;
<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;
<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;
<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ：L1nker4</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@date</span> ： 创建于  2019/3/10 17:19</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@description</span>： test</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;
        <span class="hljs-type">String</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;mybatis-config.xml&quot;</span>;
        <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> Resources.getResourceAsStream(resource);
        <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(inputStream);

        <span class="hljs-comment">//获取sqlSession实例，能直接执行已经映射的sql语句</span>
        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">openSession</span> <span class="hljs-operator">=</span>  sqlSessionFactory.openSession();
        List&lt;User&gt; user = openSession.selectList(<span class="hljs-string">&quot;com.test.UserMapper.selectUser&quot;</span>);
        System.out.println(user);

        <span class="hljs-comment">//关闭session</span>
        openSession.close();
    &#125;
&#125;
</code></pre></div>



<p>Mybatis使用步骤：</p>
<ol>
<li><p>根据配置文件，创建一个SqlSessionFactory对象</p>
</li>
<li><p>sql映射文件，配置sql语句</p>
</li>
<li><p>将sql映射文件注册到全局配置文件中</p>
</li>
<li><p>写代码</p>
<ol>
<li>根据全局配置文件得到SqlSessionFactory</li>
<li>使用sqlSession工厂，获取到sqlSession对象使用它来执行增删改查，一个SqlSession就是代表和数据库的一次会话，用完关闭。</li>
<li>使用sql的唯一标识来告诉Mybatis执行哪个sql，sql语句都保存在sql映射文件中。</li>
</ol>
</li>
</ol>
<p>接口式编程</p>
<div class="code-wrapper"><pre><code class="hljs">原生：		Dao	====&gt;	DaoImpl

Mybatis	      Mapper ====&gt;	xxMapper.xml
</code></pre></div>
<p>mapper接口没有实现类，但是mybatis会为这个接口生成一个代理对象。</p>
<p>mybatis的配置文件：包含数据库连接池的信息，事务管理器信息等，系统运行环境。</p>
<p>sql映射文件：保存了每一个sql语句的映射信息。</p>
<h3 id="Mybatis全局配置文件"><a href="#Mybatis全局配置文件" class="headerlink" title="Mybatis全局配置文件"></a>Mybatis全局配置文件</h3><p>Mybatis的配置文件包含了影响Mybatis行为的设置（setting）和属性（properties）信息。</p>
<p>configuration 配置</p>
<div class="code-wrapper"><pre><code class="hljs">properties属性

settings 设置

typeAliases 类型命名

typeHandlers 类型处理器

objectFactory 对象工厂

plugins	插件

environments 环境

    environment 环境变量

        transactionManager	事务管理器

        dataSource 数据源
</code></pre></div>
<p>databaseIdProvider 提供多个数据库厂商</p>
<p>mappers 映射器</p>
<h4 id="properties-引入配置"><a href="#properties-引入配置" class="headerlink" title="properties 引入配置"></a>properties 引入配置</h4><p>引入外部properties配置文件的内容</p>
<p>resource：类路径下的资源</p>
<p>url：引入网络路径i心爱的资源</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;db.properties&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span></code></pre></div>





<h4 id="setting-Mybatis设置"><a href="#setting-Mybatis设置" class="headerlink" title="setting Mybatis设置"></a>setting Mybatis设置</h4><p><img src="C:\Users\l1nke\AppData\Roaming\Typora\typora-user-images\1553326004994.png" srcset="/img/loading.gif" lazyload alt="1553326004994"></p>
<p>setting：用来设置每一个设置项</p>
<div class="code-wrapper"><pre><code class="hljs">name：设置项名

value：值
</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span></code></pre></div>



<h4 id="typeAliases-别名处理器"><a href="#typeAliases-别名处理器" class="headerlink" title="typeAliases 别名处理器"></a>typeAliases 别名处理器</h4><p>typeAliases：可以为Java类型起别名</p>
<div class="code-wrapper"><pre><code class="hljs">type：指定要起别名的类型全类名，默认别名就是类名小写

alias：指定新的别名，
</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">typeAlias</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.test.model.User&quot;</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;User&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span></code></pre></div>



<h5 id="package：批量起别名"><a href="#package：批量起别名" class="headerlink" title="package：批量起别名"></a>package：批量起别名</h5><div class="code-wrapper"><pre><code class="hljs">name：指定包名（为当前包以及下面的所有后代包的每一个类都起一个默认别名）
</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.test.entities&quot;</span>&gt;</span></code></pre></div>

<p>批量起别名的情况下，使用@Alias注解为某个类型指定新的别名</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Alias(&quot;per&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>&#123;
    
&#125;</code></pre></div>



<h4 id="environments-环境"><a href="#environments-环境" class="headerlink" title="environments 环境"></a>environments 环境</h4><p>Mybatis可以配置多种环境，default属性指定使用某种环境</p>
<p>environment：配置一个具体的环境信息，必须有以下两个标签，id代表当前环境的唯一标识</p>
<div class="code-wrapper"><pre><code class="hljs">transactionManager：事务管理器，

        type：事务管理器的类型，JDBC和MANAGED

        自定义事务管理器，实现TransactionFactory接口即可

dataSource：数据源

        type：数据源类型，UNPOOLED，POOLED，JNDI	

        自定义数据源：实现DataSourceFactory接口
</code></pre></div>
<p>​		</p>
<h4 id="databaseIdProvider-提供多数据库厂商"><a href="#databaseIdProvider-提供多数据库厂商" class="headerlink" title="databaseIdProvider 提供多数据库厂商"></a>databaseIdProvider 提供多数据库厂商</h4><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">databaseIdProvider</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;DB_VENDOR&quot;</span>&gt;</span>
        <span class="hljs-comment">&lt;!--为不同的数据库厂商起别名--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MySQL&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;mysql&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Oracle&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;oracle&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">databaseIdProvider</span>&gt;</span></code></pre></div>



<p>在sql映射文件中使用databaseId指定查询哪个数据库（值由配置文件中的别名决定）</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectUser&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;User&quot;</span> <span class="hljs-attr">databaseId</span>=<span class="hljs-string">&quot;mysql&quot;</span>&gt;</span>
        select uid,uname,pwd,sex,age from t_user;
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>



<h4 id="mappers-映射"><a href="#mappers-映射" class="headerlink" title="mappers 映射"></a>mappers 映射</h4><p>将sql映射注册到全局配置中</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;UserMapper.xml&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span></code></pre></div>

<p>注册配置文件</p>
<p>resource：引入类路径下的映射文件</p>
<p>url：引入磁盘或者网络路径下的映射文件</p>
<p>注册接口</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.test.dao.UserMapper&quot;</span> /&gt;</span></code></pre></div>

<p>class：引用接口</p>
<p>接口和映射文件同名，并且存在于同一目录下</p>
<h5 id="批量注册"><a href="#批量注册" class="headerlink" title="批量注册"></a>批量注册</h5><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;xxx.com.dao&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span></code></pre></div>

<p>配置文件和dao一个目录</p>
<h3 id="Mybatis映射文件"><a href="#Mybatis映射文件" class="headerlink" title="Mybatis映射文件"></a>Mybatis映射文件</h3><p>cache：命名空间的二级缓存配置</p>
<p>cache-ref：其他命名空间缓存配置的引用。</p>
<p>resultMap：自定义结果集映射</p>
<p>sql：抽取可重用语句块</p>
<p>insert：映射插入语句</p>
<p>update：映射更新语句</p>
<p>delete：映射删除语句</p>
<p>select：映射查询语句</p>
<p>mybatis允许增删改直接定义为：long，boolen，Integer。void</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//这种方式需要手动提交事务，openSession.commit();</span>
<span class="hljs-type">SqlSession</span> <span class="hljs-variable">openSession</span> <span class="hljs-operator">=</span>  sqlSessionFactory.openSession();
<span class="hljs-comment">//这种不需要提交事务</span>
<span class="hljs-type">SqlSession</span> <span class="hljs-variable">openSession</span> <span class="hljs-operator">=</span>  sqlSessionFactory.openSession(<span class="hljs-literal">true</span>);</code></pre></div>

<p>MySQL支持自增主键，自增主键的获取，mybatis利用statement.getGenratedKeys()，</p>
<div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">insert</span> id<span class="hljs-operator">=</span>&quot;addUser&quot; parameterType<span class="hljs-operator">=</span>&quot;com.test.model.User&quot; useGeneratedKeys<span class="hljs-operator">=</span>&quot;true&quot; keyProperty<span class="hljs-operator">=</span>&quot;id&quot;<span class="hljs-operator">&gt;</span>
        <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_user(uname, pwd, sex, age)
        <span class="hljs-keyword">values</span> (#&#123;uname&#125;,#&#123;pwd&#125;,#&#123;sex&#125;,#&#123;age&#125;)
<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">insert</span><span class="hljs-operator">&gt;</span></code></pre></div>



<p>useGeneratedKeys&#x3D;”true”，使用自增主键获取主键值策略</p>
<h4 id="参数处理"><a href="#参数处理" class="headerlink" title="参数处理"></a>参数处理</h4><p>单个参数</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteUserById&quot;</span>&gt;</span>
        delete from t_user where uid = #&#123;uid&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span></code></pre></div>



<p>多个参数（多个参数会被封装成一个map）</p>
<p>key：param1，paramN</p>
<p>value：传入的参数值</p>
<p>#{}是从map中获取指定的key的值</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserByIdAndUname&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span>
        select * from t_user where uid = #&#123;param1&#125; and uname = #&#123;param2&#125;
 <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>



<h6 id="使用-Param注解"><a href="#使用-Param注解" class="headerlink" title="使用@Param注解"></a>使用@Param注解</h6><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserByIdAndUname</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;uid&quot;)</span> Integer uid, <span class="hljs-meta">@Param(&quot;uname&quot;)</span> String uname)</span>;</code></pre></div>

<p>@Param注解指定对应的key值</p>
<h4 id="和-的取值区别"><a href="#和-的取值区别" class="headerlink" title="#和$的取值区别"></a>#和$的取值区别</h4><p>${}：取出的值直接拼接在sql语句中，会有安全问题</p>
<p>#{}：是以预编译的形式，将参数设置到sql语句中，PreparedStatement</p>
<p>大多情况下，取参数都应该使用#{}</p>
<p>原生jdbc不支持占位符的地方，可以使用$进行取值</p>
<p>比如 ：分表，按照年份分表拆分</p>
<div class="code-wrapper"><pre><code class="hljs xml">select * from $&#123;year&#125;_salary where xxx;</code></pre></div>



<p>#{}可以规定参数的一些规则</p>
<p>javaType，jdbcType，mode（存储过程），numericScale，resultMap，typeHandler，jdbcTypeName，</p>
<p>jdbcType</p>
<h4 id="select元素"><a href="#select元素" class="headerlink" title="select元素"></a>select元素</h4><p>id：唯一标识符</p>
<p>parameterType：参数类型</p>
<p>resultType：返回值类型，如果返回的是一个集合，要写集合中元素的类型。</p>
<h6 id="多条记录封装成一个map"><a href="#多条记录封装成一个map" class="headerlink" title="多条记录封装成一个map"></a>多条记录封装成一个map</h6><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserByUnameReturnMap&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.test.model.User&quot;</span>&gt;</span>
        select * from t_user where uname like #&#123;uname&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@MapKey(&quot;uid&quot;)</span>
    <span class="hljs-keyword">public</span> Map&lt;Integer,User&gt; <span class="hljs-title function_">getUserByUnameReturnMap</span><span class="hljs-params">(String uname)</span>;
MapKey标注某个元素为主键</code></pre></div>

<h6 id="association指定联合的JavaBean对象"><a href="#association指定联合的JavaBean对象" class="headerlink" title="association指定联合的JavaBean对象"></a>association指定联合的JavaBean对象</h6><p>property：指定哪个属性是联合的对象</p>
<p>javaType：指定这个属性对象的类型</p>
<h6 id="association定义关联对象的封装规则"><a href="#association定义关联对象的封装规则" class="headerlink" title="association定义关联对象的封装规则"></a>association定义关联对象的封装规则</h6><p>select：表明当前属性是调用select指定的方法查出的结果</p>
<p>column：指定将哪一列的值传给这个方法</p>
<p>流程：使用select指定的方法（传入column指定的这列参数的值）查出对象，并封装给property指定的属性</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;dept&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;com.test.dao.UserMapper.getUserByIdAndUname&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;d_id&quot;</span>/&gt;</span></code></pre></div>





<h5 id="延时加载"><a href="#延时加载" class="headerlink" title="延时加载"></a>延时加载</h5><p>在关联查询中，例如：查询用户订单情况时，只查用户信息而不查订单，可以启用延时加载</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lazyLoadingEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;aggressiveLazyLoading&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span></code></pre></div>



<h5 id="collection定义关联集合"><a href="#collection定义关联集合" class="headerlink" title="collection定义关联集合"></a>collection定义关联集合</h5><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;MyUser&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.test.model.User&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;uid&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uname&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;uname&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;pwd&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;pwd&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;sex&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;age&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;age&quot;</span>/&gt;</span>
    
        <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;User&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;com.test.model.Department&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;eid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span></code></pre></div>

<div class="code-wrapper"><pre><code class="hljs">    ofType：指定集合里面元素类型
</code></pre></div>
<p>collection封装一个集合</p>
<h6 id="将多列的值传递过去"><a href="#将多列的值传递过去" class="headerlink" title="将多列的值传递过去"></a>将多列的值传递过去</h6><p>将多列的值封装map传递过去</p>
<p>column&#x3D;{key1&#x3D;column1,key2&#x3D;column2}</p>
<h4 id="discriminator鉴别器"><a href="#discriminator鉴别器" class="headerlink" title="discriminator鉴别器"></a>discriminator鉴别器</h4><p>mybatis可以通过discriminator判断某列的值，然后根据某列的值改变封装行为</p>
<p>例如：如果查出的是女生，就把部门信息查询出来，否则不查询</p>
<div class="code-wrapper"><pre><code class="hljs">   如果是男生，就把username赋值给email
</code></pre></div>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">discriminator</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;String&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;gender&quot;</span>&gt;</span>
            <span class="hljs-comment">&lt;!--女生 resultType：指定封装的结果类型--&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">case</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;dept&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;com.test.dao.UserMapper.getUserByIdAndUname&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;d_id&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">case</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">case</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;dept&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;com.test.dao.UserMapper.getUserByIdAndUname&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;d_id&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">case</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">discriminator</span>&gt;</span></code></pre></div>





<h3 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h3><h4 id="if-判断"><a href="#if-判断" class="headerlink" title="if 判断"></a>if 判断</h4><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserByConditionIf&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.test.model.User&quot;</span>&gt;</span>
        select * from t_user
        where
            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;uid != null&quot;</span>&gt;</span>
                uid = #&#123;uid&#125;
            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;uname != null&quot;</span>&gt;</span>
                and uname = #&#123;&#125;
            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>

<p>test：OGNL表达式</p>
<p>遇见特殊字符需要转义</p>
<h4 id="where"><a href="#where" class="headerlink" title="where"></a>where</h4><p>可以防止因为if语句不显示，直接拼接and报错</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;uid != null&quot;</span>&gt;</span>
       uid = #&#123;uid&#125;
   <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>

   <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;uname != null&quot;</span>&gt;</span>
       and uname = #&#123;&#125;
   <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span></code></pre></div>

<p>where标签会将所有的查询条件都包括在内。mybatis会将where标签中拼接的sql多出来的and</p>
<p>或者or去掉，<strong>where只会去掉第一个多出来的and或者or</strong></p>
<h4 id="Trim-字符串截取"><a href="#Trim-字符串截取" class="headerlink" title="Trim 字符串截取"></a>Trim 字符串截取</h4><p>自定义字符串截取规则</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">trim</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">prefixOverrides</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">suffix</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">suffixOverrides</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span></code></pre></div>

<p>prefix：前缀，trim标签体中是整个字符串拼串后的结果，prefix给拼串后的整个字符加一个前缀</p>
<p>prefixOverrides：前缀覆盖，去掉整个字符串前面多余的字符</p>
<p>suffix：后缀，suffix给拼串后的整个字符加一个后缀</p>
<p>suffixOverrides：后缀覆盖</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">trim</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">&quot;where&quot;</span> <span class="hljs-attr">suffixOverrides</span>=<span class="hljs-string">&quot;and&quot;</span>&gt;</span></code></pre></div>

<p>上述代码解释：在字符串前面加一个where，将后缀的and去掉</p>
<h4 id="choose-when-otherwise-分支选择"><a href="#choose-when-otherwise-分支选择" class="headerlink" title="choose-when-otherwise 分支选择"></a>choose-when-otherwise 分支选择</h4><p>相当于switch-case</p>
<p>需求：如果带了id就用id查，如果带了lastName就用lastName查</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserByUnameReturnMap&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.test.model.User&quot;</span>&gt;</span>
        select * from t_user
        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">choose</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;id!=null&quot;</span>&gt;</span>
                    id = #&#123;id&#125;
                <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;uname!=null&quot;</span>&gt;</span>
                    uname = #&#123;uname&#125;
                <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">choose</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>



<h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><p>set元素可以用于动态包含需要更新的列,可以动态删除多余的逗号</p>
<h4 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h4><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;item_id&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>
       #&#123;item_id&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span></code></pre></div>

<p>collection：指定要遍历的集合<br>        list类型的参数会特殊处理封装在map中，map的key就叫list<br>item：将当前遍历出的元素赋值给指定的变量<br>separator：每个元素中的分隔符<br>open：遍历死哦有的结果拼接一个开始的字符<br>close：拼接一个结束的字符<br>index：索引</p>
<h4 id="内置参数"><a href="#内置参数" class="headerlink" title="内置参数"></a>内置参数</h4><p>不止方法传过来的参数可以用来判断并取值</p>
<p>mybatis默认还有两个内置参数</p>
<p>_parameter：代表整个参数</p>
<div class="code-wrapper"><pre><code class="hljs">单个参数：_parameter就是这个参数

多个参数：参数会被封装成一个map，_parameter就代表这个map
</code></pre></div>
<p>_databaseId：如果配置了databaseIdProvider标签，_databaseId就代表当前数据库的别名</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;_databaseId==&#x27;mysql&#x27;&quot;</span>&gt;</span>
	xxx
<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;_parameter!=null&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span></code></pre></div>



<h4 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h4><p>可以将OGNL表达式的值绑定到一个变量中的值</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bind</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_lastName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;lastName&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span>&gt;</span>
    	select * from users where lastName = #&#123;_lastName&#125;
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div>





<h4 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h4><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;Base_Column_List&quot;</span>&gt;</span>
    emp_id, emp_name, gender, email, d_id
  <span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addEmp&quot;</span>&gt;</span>
	insert into tbl_emp (
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;Base_Column_List&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
    )
    values xxxxx
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div>

<p>sql标签里面只能用<code>$&#123;&#125;</code>进行取值</p>
<h3 id="MyBatis缓存"><a href="#MyBatis缓存" class="headerlink" title="MyBatis缓存"></a>MyBatis缓存</h3><p>分为一级缓存（本地缓存）和二级缓存（全局缓存）</p>
<ul>
<li>默认情况下，只有一级缓存（SqlSession级别的缓存，也称为本地缓存）开启</li>
<li>二级缓存需要手动开启和配置，基于namespace级别的缓存</li>
<li>为了提高拓展性，MyBatis定义了缓存接口Cache，我们可以通过实现Cache接口来自定义二级缓存</li>
</ul>
<h4 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h4><p>与数据库同一次会话期间查询到的数据会放在本地缓存中，以后如果获取相同的数据，直接去缓存中取。</p>
<p>失效情况：</p>
<ul>
<li>sqlsession不同</li>
<li>sqlsession相同，查询条件不同</li>
<li>sqlsession相同，两次查询之间执行了增删改操作</li>
<li>sqlsession相同，手动清除了一级缓存</li>
</ul>
<h4 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h4><p>基于namespace级别的缓存，一个namespace对应一个二级缓存。</p>
<h5 id="开启全局二级缓存配置"><a href="#开启全局二级缓存配置" class="headerlink" title="开启全局二级缓存配置"></a>开启全局二级缓存配置</h5><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cacheEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">setting</span>&gt;</span></code></pre></div>



<h5 id="mapper-xml中配置"><a href="#mapper-xml中配置" class="headerlink" title="mapper.xml中配置"></a>mapper.xml中配置</h5><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">cache</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">cache</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div>

<ul>
<li>eviction：缓存回收策略<ul>
<li>LRU	最近最少使用的：移除最长时间不被使用的对象</li>
<li>FIFO        先进先出，按对象进入缓存的顺序来移除他们 </li>
<li>SOFT       软引用，移除基于垃圾回收器状态和软引用规则的对象</li>
<li>WEAK      弱引用，更积极地移除基于垃圾回收器状态和弱引用规则的对象</li>
<li>默认是LRU</li>
</ul>
</li>
<li>flushInterval：缓存刷新间隔（默认不清空）单位 毫秒</li>
<li>readOnly：是否只读<ul>
<li>true：只读，mybatis认为所有从缓存中获取数据的操作都是只读操作，不会修改数据，不安全，速度快</li>
<li>false：非只读</li>
</ul>
</li>
<li>size：缓存中存放多少元素</li>
<li>type：指定自定义缓存的全类名，实现Cache接口</li>
</ul>
<h5 id="实体类实现序列化接口"><a href="#实体类实现序列化接口" class="headerlink" title="实体类实现序列化接口"></a>实体类实现序列化接口</h5>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Java/" class="category-chain-item">Java</a>
  
  
    <span>></span>
    
  <a href="/categories/Java/Mybatis/" class="category-chain-item">Mybatis</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Java/" class="print-no-link">#Java</a>
      
        <a href="/tags/Mybatis/" class="print-no-link">#Mybatis</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Mybatis学习笔记</div>
      <div>https://l1n.wang/2019/Java基础/mybatis-note/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Lin Wang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2019年4月8日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2019/Linux/fastdfs-01/" title="FastDFS使用入门">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">FastDFS使用入门</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2019/Java%E5%9F%BA%E7%A1%80/spring01/" title="Spring学习笔记（一）">
                        <span class="hidden-mobile">Spring学习笔记（一）</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'L1nker4/blog_comment');
      s.setAttribute('issue-term', 'title');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       2018 - 2024 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>




  
<script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/love.min.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
